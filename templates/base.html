<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Sing App{% endblock %}</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='img/favicon.svg') }}">
    
    <!-- Sing App Pre-built CSS (includes Bootstrap 4.3.1 internals) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/application.min.css') }}">
    
    <!-- Custom layout styles (includes dark mode overrides via data-theme) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/singapp-custom.css') }}">
    
    <!-- Theme toggle - apply saved preference before page renders to prevent flash -->
    <script>
        (function () {
            var t = localStorage.getItem('singapp-theme');
            if (t === 'dark') { document.documentElement.setAttribute('data-theme', 'dark'); }
        })();
    </script>
    
    <!-- Morris Charts CSS (MIT) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/vendor/morris.css') }}">
    <!-- Rickshaw CSS (MIT) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/vendor/rickshaw.min.css') }}">
    <!-- Leaflet CSS (MIT - OpenStreetMap) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/vendor/leaflet.css') }}">
    
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Sidebar Overlay (for mobile) -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Top Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light top-navbar fixed-top" aria-label="Top navigation">
        <!-- Sidebar Toggle Button (mobile hamburger) -->
        <button class="navbar-toggler sidebar-toggler mr-2" type="button"
                id="sidebarToggle" aria-label="Toggle sidebar"
                aria-expanded="false" aria-controls="sidebar">
            <i class="fa-solid fa-bars"></i>
        </button>
        
        <a class="navbar-brand" href="{{ url_for('main.index') }}">Sing App</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href="#" aria-label="Notifications"><i class="fa fa-bell"></i></a>
                </li>
                <li class="nav-item">
                    <button id="themeToggle" class="btn btn-link nav-link" title="Toggle theme" aria-label="Toggle dark/light theme">
                        <i id="themeIcon" class="fa-solid fa-moon"></i>
                    </button>
                </li>
                {% if current_user.is_authenticated %}
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-label="User menu">
                        <i class="fa-solid fa-circle-user"></i> {{ current_user.username }}
                    </a>
                    <div class="dropdown-menu dropdown-menu-right">
                        <a class="dropdown-item" href="{{ url_for('auth.logout') }}">
                            <i class="fa-solid fa-right-from-bracket"></i> Log Out
                        </a>
                    </div>
                </li>
                {% elif config.get('REQUIRE_LOGIN') %}
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('auth.login') }}" aria-label="Sign in">
                        <i class="fa-solid fa-right-to-bracket"></i> Sign In
                    </a>
                </li>
                {% endif %}
            </ul>
        </div>
    </nav>

    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar" aria-label="Main navigation">
        <div class="js-sidebar-content">
            <ul class="nav flex-column">
                <!-- Dashboard -->
                <li class="nav-item {% if active_page in ['dashboard_analytics', 'dashboard_visits', 'dashboard_widgets'] %}active{% endif %}">
                    <a class="nav-link {% if active_page in ['dashboard_analytics', 'dashboard_visits', 'dashboard_widgets'] %}active{% endif %}" href="#sidebar-dashboard" data-toggle="collapse" aria-expanded="{% if active_page in ['dashboard_analytics', 'dashboard_visits', 'dashboard_widgets'] %}true{% else %}false{% endif %}">
                        <span class="icon"><i class="fa-solid fa-gauge-high"></i></span>
                        Dashboard
                    </a>
                    <ul id="sidebar-dashboard" class="collapse {% if active_page in ['dashboard_analytics', 'dashboard_visits', 'dashboard_widgets'] %}show{% endif %} nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'dashboard_analytics' %}active{% endif %}" href="{{ url_for('main.index') }}">Analytics</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'dashboard_visits' %}active{% endif %}" href="{{ url_for('examples.dashboard_visits') }}">Visits</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'dashboard_widgets' %}active{% endif %}" href="{{ url_for('examples.dashboard_widgets') }}">Widgets</a>
                        </li>
                    </ul>
                </li>
                
                {% if current_user.is_authenticated and current_user.is_admin or not config.get('REQUIRE_LOGIN') %}
                <!-- Administration -->
                <li class="nav-header">Administration</li>
                <li class="nav-item {% if active_page == 'admin_users' %}active{% endif %}">
                    <a class="nav-link {% if active_page == 'admin_users' %}active{% endif %}" href="{{ url_for('admin.users_list') }}">
                        <span class="icon"><i class="fa-solid fa-users-gear"></i></span>
                        User Management
                    </a>
                </li>
                {% endif %}
                
                {% if config.get('ENABLE_EXAMPLES', True) %}
                <!-- E-commerce -->
                <li class="nav-item {% if active_page in ['product_detail', 'product_grid'] %}active{% endif %}">
                    <a class="nav-link {% if active_page in ['product_detail', 'product_grid'] %}active{% endif %}" href="#sidebar-ecommerce" data-toggle="collapse" aria-expanded="{% if active_page in ['product_detail', 'product_grid'] %}true{% else %}false{% endif %}">
                        <span class="icon"><i class="fa fa-shopping-cart"></i></span>
                        E-commerce
                    </a>
                    <ul id="sidebar-ecommerce" class="collapse {% if active_page in ['product_detail', 'product_grid'] %}show{% endif %} nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'product_detail' %}active{% endif %}" href="{{ url_for('examples.product_detail') }}">Product Detail</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'product_grid' %}active{% endif %}" href="{{ url_for('examples.product_grid') }}">Product Grid</a>
                        </li>
                    </ul>
                </li>
                
                <!-- Template Header -->
                <li class="nav-header">Template</li>
                
                <!-- Core -->
                <li class="nav-item {% if active_page in ['core_typography', 'core_colors', 'core_grid'] %}active{% endif %}">
                    <a class="nav-link {% if active_page in ['core_typography', 'core_colors', 'core_grid'] %}active{% endif %}" href="#sidebar-core" data-toggle="collapse" aria-expanded="{% if active_page in ['core_typography', 'core_colors', 'core_grid'] %}true{% else %}false{% endif %}">
                        <span class="icon"><i class="fa-solid fa-book-open"></i></span>
                        Core
                    </a>
                    <ul id="sidebar-core" class="collapse {% if active_page in ['core_typography', 'core_colors', 'core_grid'] %}show{% endif %} nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'core_typography' %}active{% endif %}" href="{{ url_for('examples.core_typography') }}">Typography</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'core_colors' %}active{% endif %}" href="{{ url_for('examples.core_colors') }}">Colors</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'core_grid' %}active{% endif %}" href="{{ url_for('examples.core_grid') }}">Grid</a>
                        </li>
                    </ul>
                </li>
                
                <!-- UI Components -->
                <li class="nav-item {% if active_page in ['components_alerts', 'components_badges', 'components_buttons', 'components_card', 'components_modal', 'components_tabs', 'components_progress', 'components_icons', 'ui_nav', 'ui_navbar', 'ui_carousel', 'ui_list_groups', 'ui_jumbotron', 'ui_popovers', 'ui_notifications', 'ui_toasts'] %}active{% endif %}">
                    <a class="nav-link {% if active_page in ['components_alerts', 'components_badges', 'components_buttons', 'components_card', 'components_modal', 'components_tabs', 'components_progress', 'components_icons', 'ui_nav', 'ui_navbar', 'ui_carousel', 'ui_list_groups', 'ui_jumbotron', 'ui_popovers', 'ui_notifications', 'ui_toasts'] %}active{% endif %}" href="#sidebar-ui" data-toggle="collapse" aria-expanded="{% if active_page in ['components_alerts', 'components_badges', 'components_buttons', 'components_card', 'components_modal', 'components_tabs', 'components_progress', 'components_icons', 'ui_nav', 'ui_navbar', 'ui_carousel', 'ui_list_groups', 'ui_jumbotron', 'ui_popovers', 'ui_notifications', 'ui_toasts'] %}true{% else %}false{% endif %}">
                        <span class="icon"><i class="fa fa-th-large"></i></span>
                        UI Components
                    </a>
                    <ul id="sidebar-ui" class="collapse {% if active_page in ['components_alerts', 'components_badges', 'components_buttons', 'components_card', 'components_modal', 'components_tabs', 'components_progress', 'components_icons', 'ui_nav', 'ui_navbar', 'ui_carousel', 'ui_list_groups', 'ui_jumbotron', 'ui_popovers', 'ui_notifications', 'ui_toasts'] %}show{% endif %} nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'components_alerts' %}active{% endif %}" href="{{ url_for('examples.components_alerts') }}">Alerts</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'components_badges' %}active{% endif %}" href="{{ url_for('examples.components_badges') }}">Badges</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'components_buttons' %}active{% endif %}" href="{{ url_for('examples.components_buttons') }}">Buttons</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'components_card' %}active{% endif %}" href="{{ url_for('examples.components_card') }}">Card</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'components_icons' %}active{% endif %}" href="{{ url_for('examples.components_icons') }}">Icons</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'components_modal' %}active{% endif %}" href="{{ url_for('examples.components_modal') }}">Modal</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'components_tabs' %}active{% endif %}" href="{{ url_for('examples.components_tabs') }}">Tabs & Accordion</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'components_progress' %}active{% endif %}" href="{{ url_for('examples.components_progress') }}">Progress</a>
                        </li>
                    </ul>
                </li>
                
                <!-- Forms -->
                <li class="nav-item {% if active_page in ['form_elements', 'form_validation', 'form_wizard'] %}active{% endif %}">
                    <a class="nav-link {% if active_page in ['form_elements', 'form_validation', 'form_wizard'] %}active{% endif %}" href="#sidebar-forms" data-toggle="collapse" aria-expanded="{% if active_page in ['form_elements', 'form_validation', 'form_wizard'] %}true{% else %}false{% endif %}">
                        <span class="icon"><i class="fa fa-edit"></i></span>
                        Forms
                    </a>
                    <ul id="sidebar-forms" class="collapse {% if active_page in ['form_elements', 'form_validation', 'form_wizard'] %}show{% endif %} nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'form_elements' %}active{% endif %}" href="{{ url_for('examples.form_elements') }}">Form Elements</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'form_validation' %}active{% endif %}" href="{{ url_for('examples.form_validation') }}">Form Validation</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'form_wizard' %}active{% endif %}" href="{{ url_for('examples.form_wizard') }}">Form Wizard</a>
                        </li>
                    </ul>
                </li>
                
                <!-- Charts -->
                <li class="nav-item {% if active_page in ['charts_overview', 'charts_flot', 'charts_morris', 'charts_rickshaw', 'charts_sparkline', 'charts_d3', 'charts_easy_pie'] %}active{% endif %}">
                    <a class="nav-link {% if active_page in ['charts_overview', 'charts_flot', 'charts_morris', 'charts_rickshaw', 'charts_sparkline', 'charts_d3', 'charts_easy_pie'] %}active{% endif %}" href="#sidebar-charts" data-toggle="collapse" aria-expanded="{% if active_page in ['charts_overview', 'charts_flot', 'charts_morris', 'charts_rickshaw', 'charts_sparkline', 'charts_d3', 'charts_easy_pie'] %}true{% else %}false{% endif %}">
                        <span class="icon"><i class="fa fa-bar-chart"></i></span>
                        Charts
                    </a>
                    <ul id="sidebar-charts" class="collapse {% if active_page in ['charts_overview', 'charts_flot', 'charts_morris', 'charts_rickshaw', 'charts_sparkline', 'charts_d3', 'charts_easy_pie'] %}show{% endif %} nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'charts_overview' %}active{% endif %}" href="{{ url_for('examples.charts_overview') }}">Overview</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'charts_flot' %}active{% endif %}" href="{{ url_for('examples.charts_flot') }}">Flot</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'charts_morris' %}active{% endif %}" href="{{ url_for('examples.charts_morris') }}">Morris</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'charts_rickshaw' %}active{% endif %}" href="{{ url_for('examples.charts_rickshaw') }}">Rickshaw</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'charts_sparkline' %}active{% endif %}" href="{{ url_for('examples.charts_sparkline') }}">Sparkline</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'charts_easy_pie' %}active{% endif %}" href="{{ url_for('examples.charts_easy_pie') }}">Easy Pie</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'charts_d3' %}active{% endif %}" href="{{ url_for('examples.charts_d3') }}">D3</a>
                        </li>
                    </ul>
                </li>
                
                <!-- Maps -->
                <li class="nav-item {% if active_page in ['maps_google', 'maps_vector', 'maps_leaflet'] %}active{% endif %}">
                    <a class="nav-link {% if active_page in ['maps_google', 'maps_vector', 'maps_leaflet'] %}active{% endif %}" href="#sidebar-maps" data-toggle="collapse" aria-expanded="{% if active_page in ['maps_google', 'maps_vector', 'maps_leaflet'] %}true{% else %}false{% endif %}">
                        <span class="icon"><i class="fa fa-map"></i></span>
                        Maps
                    </a>
                    <ul id="sidebar-maps" class="collapse {% if active_page in ['maps_google', 'maps_vector', 'maps_leaflet'] %}show{% endif %} nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'maps_google' %}active{% endif %}" href="{{ url_for('examples.maps_google') }}">Google Maps</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'maps_vector' %}active{% endif %}" href="{{ url_for('examples.maps_vector') }}">Vector Maps</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'maps_leaflet' %}active{% endif %}" href="{{ url_for('examples.maps_leaflet') }}">Leaflet Maps</a>
                        </li>
                    </ul>
                </li>
                
                <!-- Tables -->
                <li class="nav-item {% if active_page in ['tables_basic', 'tables_dynamic'] %}active{% endif %}">
                    <a class="nav-link {% if active_page in ['tables_basic', 'tables_dynamic'] %}active{% endif %}" href="#sidebar-tables" data-toggle="collapse" aria-expanded="{% if active_page in ['tables_basic', 'tables_dynamic'] %}true{% else %}false{% endif %}">
                        <span class="icon"><i class="fa fa-table"></i></span>
                        Tables
                    </a>
                    <ul id="sidebar-tables" class="collapse {% if active_page in ['tables_basic', 'tables_dynamic'] %}show{% endif %} nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'tables_basic' %}active{% endif %}" href="{{ url_for('examples.tables_basic') }}">Tables Basic</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'tables_dynamic' %}active{% endif %}" href="{{ url_for('examples.tables_dynamic') }}">Tables Dynamic</a>
                        </li>
                    </ul>
                </li>
                
                <!-- Extra -->
                <li class="nav-item {% if active_page in ['calendar', 'invoice', 'gallery', 'search', 'time_line', 'login', 'error'] %}active{% endif %}">
                    <a class="nav-link {% if active_page in ['calendar', 'invoice', 'gallery', 'search', 'time_line', 'login', 'error'] %}active{% endif %}" href="#sidebar-extra" data-toggle="collapse" aria-expanded="{% if active_page in ['calendar', 'invoice', 'gallery', 'search', 'time_line', 'login', 'error'] %}true{% else %}false{% endif %}">
                        <span class="icon"><i class="fa fa-file"></i></span>
                        Extra
                    </a>
                    <ul id="sidebar-extra" class="collapse {% if active_page in ['calendar', 'invoice', 'gallery', 'search', 'time_line', 'login', 'error'] %}show{% endif %} nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'calendar' %}active{% endif %}" href="{{ url_for('examples.calendar') }}">Calendar</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'invoice' %}active{% endif %}" href="{{ url_for('examples.invoice') }}">Invoice</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'gallery' %}active{% endif %}" href="{{ url_for('examples.gallery') }}">Gallery</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'search' %}active{% endif %}" href="{{ url_for('examples.search') }}">Search</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'time_line' %}active{% endif %}" href="{{ url_for('examples.timeline') }}">Timeline</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'login' %}active{% endif %}" href="{{ url_for('examples.login') }}">Login</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'error' %}active{% endif %}" href="{{ url_for('examples.error_page') }}">Error</a>
                        </li>
                    </ul>
                </li>
                
                <!-- Other -->
                <li class="nav-item {% if active_page in ['chat', 'email', 'grid', 'landing', 'package', 'profile'] %}active{% endif %}">
                    <a class="nav-link {% if active_page in ['chat', 'email', 'grid', 'landing', 'package', 'profile'] %}active{% endif %}" href="#sidebar-other" data-toggle="collapse" aria-expanded="{% if active_page in ['chat', 'email', 'grid', 'landing', 'package', 'profile'] %}true{% else %}false{% endif %}">
                        <span class="icon"><i class="fa fa-clone"></i></span>
                        Other Pages
                    </a>
                    <ul id="sidebar-other" class="collapse {% if active_page in ['chat', 'email', 'grid', 'landing', 'package', 'profile'] %}show{% endif %} nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'chat' %}active{% endif %}" href="{{ url_for('examples.chat') }}">Chat</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'email' %}active{% endif %}" href="{{ url_for('examples.inbox') }}">Inbox</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'profile' %}active{% endif %}" href="{{ url_for('examples.profile') }}">Profile</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'grid' %}active{% endif %}" href="{{ url_for('examples.grid') }}">Grid</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'landing' %}active{% endif %}" href="{{ url_for('examples.landing') }}">Landing</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'package' %}active{% endif %}" href="{{ url_for('examples.package') }}">Package</a>
                        </li>
                    </ul>
                </li>
                {% endif %}
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Flash messages â€” rendered here so all pages benefit automatically -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="flash-messages px-3 pt-3">
            {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

    <!-- Core vendor JS (local - staged by scripts/stage_assets.py) -->
    <script src="{{ url_for('static', filename='js/vendor/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/vendor/popper.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/vendor/bootstrap.min.js') }}"></script>
    <!-- Chart.js (MIT) -->
    <script src="{{ url_for('static', filename='js/vendor/chart.umd.min.js') }}"></script>
    <!-- Morris Charts (MIT) -->
    <script src="{{ url_for('static', filename='js/vendor/raphael.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/vendor/morris.min.js') }}"></script>
    <!-- Flot Charts (MIT) -->
    <script src="{{ url_for('static', filename='js/vendor/jquery.flot.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/vendor/jquery.flot.time.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/vendor/jquery.flot.pie.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/vendor/jquery.flot.stack.min.js') }}"></script>
    <!-- D3.js v3.x (required for Rickshaw) -->
    <script src="{{ url_for('static', filename='js/vendor/d3.min.js') }}"></script>
    <!-- Rickshaw (MIT) -->
    <script src="{{ url_for('static', filename='js/vendor/rickshaw.min.js') }}"></script>
    <!-- jQuery Animate Number (MIT) -->
    <script src="{{ url_for('static', filename='js/vendor/jquery.animateNumber.min.js') }}"></script>
    <!-- FullCalendar (MIT) -->
    <script src="{{ url_for('static', filename='js/vendor/fullcalendar.global.min.js') }}"></script>
    <!-- Leaflet JS (MIT - OpenStreetMap) -->
    <script src="{{ url_for('static', filename='js/vendor/leaflet.js') }}"></script>
    
    <!-- Theme Toggle and Sidebar Scripts -->
    <script>
    (function () {
        var btn = document.getElementById('themeToggle');
        var icon = document.getElementById('themeIcon');

        function applyTheme(theme) {
            if (theme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                icon.className = 'fa-solid fa-sun';
            } else {
                document.documentElement.removeAttribute('data-theme');
                icon.className = 'fa-solid fa-moon';
            }
            localStorage.setItem('singapp-theme', theme);
        }

        // Apply saved preference on load
        applyTheme(localStorage.getItem('singapp-theme') || 'light');

        btn.addEventListener('click', function () {
            var current = localStorage.getItem('singapp-theme') || 'light';
            applyTheme(current === 'dark' ? 'light' : 'dark');
        });

        // Mobile sidebar toggle
        var sidebar = document.getElementById('sidebar');
        var overlay = document.getElementById('sidebarOverlay');
        var sidebarToggle = document.getElementById('sidebarToggle');

        function openSidebar() {
            sidebar.classList.add('sidebar-open');
            overlay.classList.add('show');
            if (sidebarToggle) { sidebarToggle.setAttribute('aria-expanded', 'true'); }
        }

        function closeSidebar() {
            sidebar.classList.remove('sidebar-open');
            overlay.classList.remove('show');
            if (sidebarToggle) { sidebarToggle.setAttribute('aria-expanded', 'false'); }
        }

        if (sidebarToggle) {
            sidebarToggle.addEventListener('click', function() {
                if (sidebar.classList.contains('sidebar-open')) {
                    closeSidebar();
                } else {
                    openSidebar();
                }
            });
        }
        if (overlay) { overlay.addEventListener('click', closeSidebar); }

        // Close sidebar when a nav link is clicked on mobile
        var navLinks = sidebar ? sidebar.querySelectorAll('a.nav-link') : [];
        navLinks.forEach(function (link) {
            link.addEventListener('click', function () {
                if (window.innerWidth < 768) { closeSidebar(); }
            });
        });
    })();
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>
