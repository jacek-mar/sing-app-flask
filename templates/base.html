<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Sing App{% endblock %}</title>
    
    <!-- Sing App Pre-built CSS (includes Bootstrap 4.3.1 internals) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/application.min.css') }}">
    
    <!-- Dark theme (conditional) -->
    {% if config.get('ENABLE_DARK_THEME') %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/application-dark.min.css') }}">
    {% endif %}
    
    <!-- Theme toggle - apply saved preference before page renders to prevent flash -->
    <script>
        (function () {
            var t = localStorage.getItem('singapp-theme');
            if (t === 'dark') { document.documentElement.setAttribute('data-theme', 'dark'); }
        })();
    </script>
    
    <!-- Font Awesome (CDN - TODO: stage locally for offline use) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Morris Charts CSS (MIT) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css">
    <!-- Rickshaw CSS (MIT) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/rickshaw/1.6.6/rickshaw.min.css">
    <!-- FullCalendar CSS (MIT) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css">
    <!-- Leaflet CSS (MIT - OpenStreetMap) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    
    <style>
        body {
            padding-top: 56px;
            background-color: #f5f7fa;
        }
        .sidebar {
            position: fixed;
            top: 56px;
            bottom: 0;
            left: 0;
            z-index: 100;
            padding: 48px 0 0;
            box-shadow: 1px 0 5px rgba(0,0,0,0.1);
            background-color: #22262e;
            width: 240px;
            overflow-y: auto;
            overflow-x: hidden;
        }
        .sidebar a {
            color: #aab2bd;
            padding: 10px 20px;
            display: block;
            font-size: 14px;
            text-decoration: none;
        }
        .sidebar a:hover, .sidebar a.active {
            background-color: #2c3139;
            color: #fff;
        }
        .sidebar .nav-header {
            color: #6c757d;
            font-size: 11px;
            text-transform: uppercase;
            padding: 15px 20px 5px;
            font-weight: 600;
        }
        .sidebar .nav-item {
            margin-bottom: 0;
        }
        .sidebar .nav-item a {
            padding-left: 30px;
        }
        .sidebar .nav-item .nav-item a {
            padding-left: 45px;
        }
        .sidebar .collapse {
            display: none;
        }
        .sidebar .collapse.show {
            display: block;
        }
        .sidebar .nav-item a[data-toggle="collapse"] {
            position: relative;
        }
        .sidebar .nav-item a[data-toggle="collapse"]::after {
            position: absolute;
            right: 15px;
            content: '\f107';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
        }
        .sidebar .nav-item a[data-toggle="collapse"][aria-expanded="true"]::after {
            content: '\f106';
        }
        .main-content {
            margin-left: 240px;
            padding: 20px;
        }
        .top-navbar {
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .widget {
            background: #fff;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .widget header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
        }
        .widget-body {
            padding: 20px;
        }
        .page-title {
            margin-bottom: 20px;
        }
        .page-title h3 {
            margin: 0;
            font-size: 24px;
            font-weight: 500;
        }
        .sidebar .icon {
            width: 24px;
            margin-right: 10px;
            text-align: center;
        }
    </style>
    
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Top Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light top-navbar fixed-top">
        <a class="navbar-brand" href="{{ url_for('main.index') }}">Sing App</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href="#"><i class="fa fa-bell"></i></a>
                </li>
                <li class="nav-item">
                    <button id="themeToggle" class="btn btn-link nav-link" title="Toggle theme">
                        <i id="themeIcon" class="fa-solid fa-moon"></i>
                    </button>
                </li>
                {% if current_user.is_authenticated %}
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown">
                        <i class="fa-solid fa-circle-user"></i> {{ current_user.username }}
                    </a>
                    <div class="dropdown-menu dropdown-menu-right">
                        <a class="dropdown-item" href="{{ url_for('auth.logout') }}">
                            <i class="fa-solid fa-right-from-bracket"></i> Log Out
                        </a>
                    </div>
                </li>
                {% elif config.get('REQUIRE_LOGIN') %}
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('auth.login') }}">
                        <i class="fa-solid fa-right-to-bracket"></i> Sign In
                    </a>
                </li>
                {% endif %}
            </ul>
        </div>
    </nav>

    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="js-sidebar-content">
            <ul class="nav flex-column">
                <!-- Dashboard -->
                <li class="nav-item {% if active_page in ['dashboard_analytics', 'dashboard_visits', 'dashboard_widgets'] %}active{% endif %}">
                    <a class="nav-link {% if active_page in ['dashboard_analytics', 'dashboard_visits', 'dashboard_widgets'] %}active{% endif %}" href="#sidebar-dashboard" data-toggle="collapse" aria-expanded="{% if active_page in ['dashboard_analytics', 'dashboard_visits', 'dashboard_widgets'] %}true{% else %}false{% endif %}">
                        <span class="icon"><i class="fa-solid fa-gauge-high"></i></span>
                        Dashboard
                    </a>
                    <ul id="sidebar-dashboard" class="collapse {% if active_page in ['dashboard_analytics', 'dashboard_visits', 'dashboard_widgets'] %}show{% endif %} nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'dashboard_analytics' %}active{% endif %}" href="{{ url_for('main.index') }}">Analytics</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'dashboard_visits' %}active{% endif %}" href="{{ url_for('examples.dashboard_visits') }}">Visits</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'dashboard_widgets' %}active{% endif %}" href="{{ url_for('examples.dashboard_widgets') }}">Widgets</a>
                        </li>
                    </ul>
                </li>
                
                {% if current_user.is_authenticated and current_user.is_admin or not config.get('REQUIRE_LOGIN') %}
                <!-- Administration -->
                <li class="nav-header">Administration</li>
                <li class="nav-item {% if active_page == 'admin_users' %}active{% endif %}">
                    <a class="nav-link {% if active_page == 'admin_users' %}active{% endif %}" href="{{ url_for('admin.users_list') }}">
                        <span class="icon"><i class="fa-solid fa-users-gear"></i></span>
                        User Management
                    </a>
                </li>
                {% endif %}
                
                {% if config.get('ENABLE_EXAMPLES', True) %}
                <!-- E-commerce -->
                <li class="nav-item {% if active_page in ['product_detail', 'product_grid'] %}active{% endif %}">
                    <a class="nav-link {% if active_page in ['product_detail', 'product_grid'] %}active{% endif %}" href="#sidebar-ecommerce" data-toggle="collapse" aria-expanded="{% if active_page in ['product_detail', 'product_grid'] %}true{% else %}false{% endif %}">
                        <span class="icon"><i class="fa fa-shopping-cart"></i></span>
                        E-commerce
                    </a>
                    <ul id="sidebar-ecommerce" class="collapse {% if active_page in ['product_detail', 'product_grid'] %}show{% endif %} nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'product_detail' %}active{% endif %}" href="{{ url_for('examples.product_detail') }}">Product Detail</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'product_grid' %}active{% endif %}" href="{{ url_for('examples.product_grid') }}">Product Grid</a>
                        </li>
                    </ul>
                </li>
                
                <!-- Template Header -->
                <li class="nav-header">Template</li>
                
                <!-- Core -->
                <li class="nav-item {% if active_page in ['core_typography', 'core_colors', 'core_grid'] %}active{% endif %}">
                    <a class="nav-link {% if active_page in ['core_typography', 'core_colors', 'core_grid'] %}active{% endif %}" href="#sidebar-core" data-toggle="collapse" aria-expanded="{% if active_page in ['core_typography', 'core_colors', 'core_grid'] %}true{% else %}false{% endif %}">
                        <span class="icon"><i class="fa-solid fa-book-open"></i></span>
                        Core
                    </a>
                    <ul id="sidebar-core" class="collapse {% if active_page in ['core_typography', 'core_colors', 'core_grid'] %}show{% endif %} nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'core_typography' %}active{% endif %}" href="{{ url_for('examples.core_typography') }}">Typography</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'core_colors' %}active{% endif %}" href="{{ url_for('examples.core_colors') }}">Colors</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'core_grid' %}active{% endif %}" href="{{ url_for('examples.core_grid') }}">Grid</a>
                        </li>
                    </ul>
                </li>
                
                <!-- UI Components -->
                <li class="nav-item {% if active_page in ['components_alerts', 'components_badges', 'components_buttons', 'components_card', 'components_modal', 'components_tabs', 'components_progress', 'components_icons', 'ui_nav', 'ui_navbar', 'ui_carousel', 'ui_list_groups', 'ui_jumbotron', 'ui_popovers', 'ui_notifications', 'ui_toasts'] %}active{% endif %}">
                    <a class="nav-link {% if active_page in ['components_alerts', 'components_badges', 'components_buttons', 'components_card', 'components_modal', 'components_tabs', 'components_progress', 'components_icons', 'ui_nav', 'ui_navbar', 'ui_carousel', 'ui_list_groups', 'ui_jumbotron', 'ui_popovers', 'ui_notifications', 'ui_toasts'] %}active{% endif %}" href="#sidebar-ui" data-toggle="collapse" aria-expanded="{% if active_page in ['components_alerts', 'components_badges', 'components_buttons', 'components_card', 'components_modal', 'components_tabs', 'components_progress', 'components_icons', 'ui_nav', 'ui_navbar', 'ui_carousel', 'ui_list_groups', 'ui_jumbotron', 'ui_popovers', 'ui_notifications', 'ui_toasts'] %}true{% else %}false{% endif %}">
                        <span class="icon"><i class="fa fa-th-large"></i></span>
                        UI Components
                    </a>
                    <ul id="sidebar-ui" class="collapse {% if active_page in ['components_alerts', 'components_badges', 'components_buttons', 'components_card', 'components_modal', 'components_tabs', 'components_progress', 'components_icons', 'ui_nav', 'ui_navbar', 'ui_carousel', 'ui_list_groups', 'ui_jumbotron', 'ui_popovers', 'ui_notifications', 'ui_toasts'] %}show{% endif %} nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'components_alerts' %}active{% endif %}" href="{{ url_for('examples.components_alerts') }}">Alerts</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'components_badges' %}active{% endif %}" href="{{ url_for('examples.components_badges') }}">Badges</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'components_buttons' %}active{% endif %}" href="{{ url_for('examples.components_buttons') }}">Buttons</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'components_card' %}active{% endif %}" href="{{ url_for('examples.components_card') }}">Card</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'components_icons' %}active{% endif %}" href="{{ url_for('examples.components_icons') }}">Icons</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'components_modal' %}active{% endif %}" href="{{ url_for('examples.components_modal') }}">Modal</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'components_tabs' %}active{% endif %}" href="{{ url_for('examples.components_tabs') }}">Tabs & Accordion</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'components_progress' %}active{% endif %}" href="{{ url_for('examples.components_progress') }}">Progress</a>
                        </li>
                    </ul>
                </li>
                
                <!-- Forms -->
                <li class="nav-item {% if active_page in ['form_elements', 'form_validation', 'form_wizard'] %}active{% endif %}">
                    <a class="nav-link {% if active_page in ['form_elements', 'form_validation', 'form_wizard'] %}active{% endif %}" href="#sidebar-forms" data-toggle="collapse" aria-expanded="{% if active_page in ['form_elements', 'form_validation', 'form_wizard'] %}true{% else %}false{% endif %}">
                        <span class="icon"><i class="fa fa-edit"></i></span>
                        Forms
                    </a>
                    <ul id="sidebar-forms" class="collapse {% if active_page in ['form_elements', 'form_validation', 'form_wizard'] %}show{% endif %} nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'form_elements' %}active{% endif %}" href="{{ url_for('examples.form_elements') }}">Form Elements</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'form_validation' %}active{% endif %}" href="{{ url_for('examples.form_validation') }}">Form Validation</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'form_wizard' %}active{% endif %}" href="{{ url_for('examples.form_wizard') }}">Form Wizard</a>
                        </li>
                    </ul>
                </li>
                
                <!-- Charts -->
                <li class="nav-item {% if active_page in ['charts_overview', 'charts_flot', 'charts_morris', 'charts_rickshaw', 'charts_sparkline', 'charts_d3', 'charts_easy_pie'] %}active{% endif %}">
                    <a class="nav-link {% if active_page in ['charts_overview', 'charts_flot', 'charts_morris', 'charts_rickshaw', 'charts_sparkline', 'charts_d3', 'charts_easy_pie'] %}active{% endif %}" href="#sidebar-charts" data-toggle="collapse" aria-expanded="{% if active_page in ['charts_overview', 'charts_flot', 'charts_morris', 'charts_rickshaw', 'charts_sparkline', 'charts_d3', 'charts_easy_pie'] %}true{% else %}false{% endif %}">
                        <span class="icon"><i class="fa fa-bar-chart"></i></span>
                        Charts
                    </a>
                    <ul id="sidebar-charts" class="collapse {% if active_page in ['charts_overview', 'charts_flot', 'charts_morris', 'charts_rickshaw', 'charts_sparkline', 'charts_d3', 'charts_easy_pie'] %}show{% endif %} nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'charts_overview' %}active{% endif %}" href="{{ url_for('examples.charts_overview') }}">Overview</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'charts_flot' %}active{% endif %}" href="{{ url_for('examples.charts_flot') }}">Flot</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'charts_morris' %}active{% endif %}" href="{{ url_for('examples.charts_morris') }}">Morris</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'charts_rickshaw' %}active{% endif %}" href="{{ url_for('examples.charts_rickshaw') }}">Rickshaw</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'charts_sparkline' %}active{% endif %}" href="{{ url_for('examples.charts_sparkline') }}">Sparkline</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'charts_easy_pie' %}active{% endif %}" href="{{ url_for('examples.charts_easy_pie') }}">Easy Pie</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'charts_d3' %}active{% endif %}" href="{{ url_for('examples.charts_d3') }}">D3</a>
                        </li>
                    </ul>
                </li>
                
                <!-- Maps -->
                <li class="nav-item {% if active_page in ['maps_google', 'maps_vector', 'maps_leaflet'] %}active{% endif %}">
                    <a class="nav-link {% if active_page in ['maps_google', 'maps_vector', 'maps_leaflet'] %}active{% endif %}" href="#sidebar-maps" data-toggle="collapse" aria-expanded="{% if active_page in ['maps_google', 'maps_vector', 'maps_leaflet'] %}true{% else %}false{% endif %}">
                        <span class="icon"><i class="fa fa-map"></i></span>
                        Maps
                    </a>
                    <ul id="sidebar-maps" class="collapse {% if active_page in ['maps_google', 'maps_vector', 'maps_leaflet'] %}show{% endif %} nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'maps_google' %}active{% endif %}" href="{{ url_for('examples.maps_google') }}">Google Maps</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'maps_vector' %}active{% endif %}" href="{{ url_for('examples.maps_vector') }}">Vector Maps</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'maps_leaflet' %}active{% endif %}" href="{{ url_for('examples.maps_leaflet') }}">Leaflet Maps</a>
                        </li>
                    </ul>
                </li>
                
                <!-- Tables -->
                <li class="nav-item {% if active_page in ['tables_basic', 'tables_dynamic'] %}active{% endif %}">
                    <a class="nav-link {% if active_page in ['tables_basic', 'tables_dynamic'] %}active{% endif %}" href="#sidebar-tables" data-toggle="collapse" aria-expanded="{% if active_page in ['tables_basic', 'tables_dynamic'] %}true{% else %}false{% endif %}">
                        <span class="icon"><i class="fa fa-table"></i></span>
                        Tables
                    </a>
                    <ul id="sidebar-tables" class="collapse {% if active_page in ['tables_basic', 'tables_dynamic'] %}show{% endif %} nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'tables_basic' %}active{% endif %}" href="{{ url_for('examples.tables_basic') }}">Tables Basic</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'tables_dynamic' %}active{% endif %}" href="{{ url_for('examples.tables_dynamic') }}">Tables Dynamic</a>
                        </li>
                    </ul>
                </li>
                
                <!-- Extra -->
                <li class="nav-item {% if active_page in ['calendar', 'invoice', 'gallery', 'search', 'time_line', 'login', 'error'] %}active{% endif %}">
                    <a class="nav-link {% if active_page in ['calendar', 'invoice', 'gallery', 'search', 'time_line', 'login', 'error'] %}active{% endif %}" href="#sidebar-extra" data-toggle="collapse" aria-expanded="{% if active_page in ['calendar', 'invoice', 'gallery', 'search', 'time_line', 'login', 'error'] %}true{% else %}false{% endif %}">
                        <span class="icon"><i class="fa fa-file"></i></span>
                        Extra
                    </a>
                    <ul id="sidebar-extra" class="collapse {% if active_page in ['calendar', 'invoice', 'gallery', 'search', 'time_line', 'login', 'error'] %}show{% endif %} nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'calendar' %}active{% endif %}" href="{{ url_for('examples.calendar') }}">Calendar</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'invoice' %}active{% endif %}" href="{{ url_for('examples.invoice') }}">Invoice</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'gallery' %}active{% endif %}" href="{{ url_for('examples.gallery') }}">Gallery</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'search' %}active{% endif %}" href="{{ url_for('examples.search') }}">Search</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'time_line' %}active{% endif %}" href="{{ url_for('examples.timeline') }}">Timeline</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'login' %}active{% endif %}" href="{{ url_for('examples.login') }}">Login</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'error' %}active{% endif %}" href="{{ url_for('examples.error_page') }}">Error</a>
                        </li>
                    </ul>
                </li>
                
                <!-- Other -->
                <li class="nav-item {% if active_page in ['chat', 'email', 'grid', 'landing', 'package', 'profile'] %}active{% endif %}">
                    <a class="nav-link {% if active_page in ['chat', 'email', 'grid', 'landing', 'package', 'profile'] %}active{% endif %}" href="#sidebar-other" data-toggle="collapse" aria-expanded="{% if active_page in ['chat', 'email', 'grid', 'landing', 'package', 'profile'] %}true{% else %}false{% endif %}">
                        <span class="icon"><i class="fa fa-clone"></i></span>
                        Other Pages
                    </a>
                    <ul id="sidebar-other" class="collapse {% if active_page in ['chat', 'email', 'grid', 'landing', 'package', 'profile'] %}show{% endif %} nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'chat' %}active{% endif %}" href="{{ url_for('examples.chat') }}">Chat</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'email' %}active{% endif %}" href="{{ url_for('examples.inbox') }}">Inbox</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'profile' %}active{% endif %}" href="{{ url_for('examples.profile') }}">Profile</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'grid' %}active{% endif %}" href="{{ url_for('examples.grid') }}">Grid</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'landing' %}active{% endif %}" href="{{ url_for('examples.landing') }}">Landing</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if active_page == 'package' %}active{% endif %}" href="{{ url_for('examples.package') }}">Package</a>
                        </li>
                    </ul>
                </li>
                {% endif %}
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        {% block content %}{% endblock %}
    </main>

    <!-- Core vendor JS (local - staged by scripts/stage_assets.py) -->
    <script src="{{ url_for('static', filename='js/vendor/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/vendor/popper.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/vendor/bootstrap.min.js') }}"></script>
    <!-- Chart.js (MIT) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Morris Charts (MIT) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.min.js"></script>
    <!-- Flot Charts (MIT) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flot/0.8.3/jquery.flot.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flot/0.8.3/jquery.flot.time.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flot/0.8.3/jquery.flot.pie.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flot/0.8.3/jquery.flot.stack.min.js"></script>
    <!-- D3.js v3.x (required for Rickshaw) - must load before Rickshaw -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
    <!-- Rickshaw (MIT) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rickshaw/1.6.6/rickshaw.min.js"></script>
    <!-- jQuery Animate Number (MIT) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-animateNumber/0.0.14/jquery.animateNumber.min.js"></script>
    <!-- FullCalendar (MIT) -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <!-- Leaflet JS (MIT - OpenStreetMap) -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Theme Toggle Script -->
    <script>
    (function () {
        var btn = document.getElementById('themeToggle');
        var icon = document.getElementById('themeIcon');
        var darkCssId = 'dark-theme-css';

        function applyTheme(theme) {
            var existing = document.getElementById(darkCssId);
            if (theme === 'dark') {
                if (!existing) {
                    var link = document.createElement('link');
                    link.id = darkCssId;
                    link.rel = 'stylesheet';
                    link.href = '{{ url_for("static", filename="css/application-dark.min.css") }}';
                    document.head.appendChild(link);
                }
                icon.className = 'fa-solid fa-sun';
            } else {
                if (existing) { existing.remove(); }
                icon.className = 'fa-solid fa-moon';
            }
            localStorage.setItem('singapp-theme', theme);
        }

        // Apply saved preference on load
        applyTheme(localStorage.getItem('singapp-theme') || 'light');

        btn.addEventListener('click', function () {
            var current = localStorage.getItem('singapp-theme') || 'light';
            applyTheme(current === 'dark' ? 'light' : 'dark');
        });
    })();
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>
